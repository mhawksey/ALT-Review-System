<script>
   
  $(function() {
    var IS_FILTERED = true;
    var SHEET = {};

    // get all submissions from the google sheet
    google.script.run.withSuccessHandler(getSubs)
      .getAllSubmissionData(mode);

    // get all submissions handler
    function getSubs(sheet) {
      SHEET = JSON.parse(sheet);
      showSubs(currentRow);
    }
    // update dialog title text
    $('#rowNum').text(currentRow);

    // pagination events
    $('#pagePrev').on('click', function() {
      currentRow--;
      showSubs(currentRow, '--');
    });
    $('#pageNext').on('click', function() {
      currentRow++;
      showSubs(currentRow, '++');
    });

    // filter event
    $('#include_filter').on('click', function() {
      IS_FILTERED = !IS_FILTERED;
      $(this).toggleClass("active")
    });

    // include/exclude buttons event
    $("[id$='_review']").on('click', function(el) {
      $('.progress').show();
      $("[id$='_review']").removeClass('active');
      $("[id$='_review']").addClass('disabled');
      var value = el.target.id.split('_')[0];
      google.script.run.withSuccessHandler(function(result) {
        console.log(result);
        $("[id$='_review']").removeClass('active')
        $("[id$='_review']").removeClass('disabled');
        $('#' + result).addClass('active');
        $('.progress').hide();
      }).setReviewStatus(currentRow, value);
    });

    // pagination event handler
    function showSubs(showRow, direction) {
      var data = SHEET;
      var r = data[showRow - 2];
      if (IS_FILTERED && r['hidden'] !== undefined) {
        eval('currentRow' + direction);
        return showSubs(currentRow, direction);
      }
      $('#rowNum').text(currentRow - 1);
      updateFields(r);
      var toReview = r['Include']
      $("[id$='_review']").removeClass('active');
      $('#' + toReview + '_review').addClass('active');
    }
    
    // review form event
    $("#decision_form").on('submit', function(e) {
      e.preventDefault();
      var action = $("[id$=_but][clicked=true]").removeAttr('clicked')
                                                .prop("id")
                                                .split('_')[0];
      $('#action').val(action);                                         
      $('[id$=_but]').addClass('disabled');
      $('.progress').show();
      google.script.run.withSuccessHandler(handleReviewAdminResponse)
                       .processReviewAdminForm(this);
      /*$('#session_title').val($('#title').val());
      $('#token').val(token);
      $('#review_token').val(review_token);
      $('#reviewer_token').val(reviewer_token);
      $('#reviewer_num').val(reviewer_num);
      google.script.run.withSuccessHandler(handleReviewResponse).processReviewForm(this);*/
      $('.setting').prop("disabled", true);
      //$('select').material_select();
    });
    
    $('[id$=_but]').on('click', function() {
        $("button[type=submit]", $(this).parents("form")).removeAttr("clicked");
        $(this).attr("clicked", "true");
    });
    
    $('#reset_feedback').on('click', function(e) {
    console.log('clicked')
      e.preventDefault();
      $('#feedback_area').val(default_feedback);
    });
    
    // review form event handler
    function handleReviewAdminResponse(data) {
      $('.progress').hide();
      $('[id$=_but]').removeClass('disabled');
      console.log(data);
    }
  });
</script>
