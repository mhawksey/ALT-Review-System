<script>
  $(function() {
    google.script.run.withSuccessHandler(getSubs)
      .getData();
    var IS_FILTERED = false;
    var SHEET = {};
    $('#rowNum').text(currentRow);

    function getSubs(sheet) {
      SHEET = JSON.parse(sheet);
      showSubs(currentRow);
    }

    $('#pagePrev').on('click', function() {
      currentRow--;
      showSubs(currentRow, '--');
    });

    $('#pageNext').on('click', function() {
      currentRow++;
      showSubs(currentRow, '++');
    });
    
    $('#include_filter').on('click', function() {
      IS_FILTERED = !IS_FILTERED;
      $( this ).toggleClass( "active" )
    });
    
    $("[id$='_review']").on('click', function(el) {
    $('.progress').show();
      $("[id$='_review']").removeClass('active');
      $("[id$='_review']").addClass('disabled');
      google.script.run.withSuccessHandler(function(result){
      console.log(result);
        $("[id$='_review']").removeClass('active')
        $("[id$='_review']").removeClass('disabled');
        $('#'+result).addClass('active');
        $('.progress').hide();
      }).setReviewStatus(currentRow, el.target.id);
    });
    

    function showSubs(showRow, direction) {
      var data = SHEET;
      var r = data[showRow - 2];
      if (IS_FILTERED && r['Include'] === 'no'){
        eval('currentRow'+direction);
        return showSubs(currentRow, direction);
      }
      $('#rowNum').text(currentRow-1);
      updateFields(r);
      var toReview = r['Include']
      $("[id$='_review']").removeClass('active');
      $('#'+toReview+'_review').addClass('active');
    }
  });
</script>