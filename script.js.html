<script> 
  var default_feedback ="";
  function updateFields(r) {
    // remove review decision classes
    $( "[id^='Review'] .review_dec > i" ).removeClass().addClass('material-icons');
    $('#feedback_area').val('');
    $('.review_type').hide()

    // update fields from sheet data 
    $('#ID').val(r['ID']);
    $('#rowTitle').text(r['Session title']);
    $('#name').val(r['First Name'] + ' ' + r['Last Name']);
    $('#inst').val(r['Institution (if applicable)']);
    $('#sectors').val(r['Which sector(s) are you based in?']);
    $('#title').val(r['Session title']);
    $('#theme').val(r['Which conference theme best fits your session?'].split(':')[0]);
    $('#type').val(r['Select what kind of session you\'d like to run:']);
    $('#desc_area').val(r['Session description']);
    $('#desc_area_count').text('~' + countWords(r['Session description']) + '/500 words');
    $('#eval_area').val(r['Session content: evaluation and reflection']);
    $('#eval_area_count').text('~' + countWords(r['Session content: evaluation and reflection']) + '/500 words');
    $('#ref_area').val(r['References']);
    $('#resources_area').val(r['Resources for participants']);
    
    // add review responses
    if (mode === 'reviewAdmin'){
      $('[id$=_but]').removeClass('disabled')
                     .removeAttr('clicked');
      // remove collapsible
      $('#reviews_text').empty();
      $("#feedback_decision").val(r['Decision'])
                             .material_select();
      $("#hashed_id").val(r['Hashed ID']);
      $('#feedback_area').val(r['Feedback Text']);
      default_feedback ="";      
      console.log(r);
      for (var i = 1; i <= 4; i++){
        var rev = 'Review'+i;
        var resp = r[rev+' Status'];
        var type = resp.split('_');
        $('#'+rev+' .review_dec > i').addClass(type[0]);
        $('#'+rev+' .status').text(resp);
        $('#'+rev+' .type').text(r[rev+' Type']);
        if (resp === 'accept_different_type'){
          $('#'+rev+' .review_type').show();
        } else {
          $('#'+rev+' .review_type').hide();
        }
        var icon = $('#'+rev+' .review_dec > i');
        if (type[0] === 'accept' && type.length === 1){
          icon.text('sentiment_very_satisfied');
        } else if (type[0] === 'accept'){
          icon.text('sentiment_satisfied');
        } else if (type[0] === 'reject'){
          icon.text('sentiment_very_dissatisfied');
        } else if (type[0] === 'resubmit'){
          icon.text('sentiment_dissatisfied');
        } else {
          icon.text('block');
        }
        var review_feedback = 'Reviewer '+i+'\n'+(r[rev+' Text'])+'\n\n';
        if (r[rev+' Text'] && r['Feedback Text'] ===""){
          var feed = $('#feedback_area');
          var cur = feed.val();
          var append = cur + review_feedback;
          feed.val(append);
        } else if (r[rev+' Text']){
          default_feedback += review_feedback
        }
        
        
        /*if (r[rev+' Text'] || resp === 'accept_different_type'){
          var feed = $('#feedback_area');
          var cur = feed.val();
          var append = cur +'Reviewer '+i+'\n'+(r[rev+' Text'])+'\n\n';
          feed.val(append);
          $('#reviews_text').append('<li>' +
                                      '<div class="collapsible-header"><i class="material-icons">keyboard_arrow_up</i>'+rev+' Feedback</div>'+
                                      '<div class="collapsible-body"><div class="row" style="display:none" id="type_'+i+
                                      '"><div class="col s12"><label>Change of type</label></div></div><div class="row"><div class="input-field col s12"><textarea id="feedback_'+i+'" class="materialize-textarea" disabled>'+r[rev+' Text']+
                                      '</textarea><label class="active" for="feedback_'+i+'">Feedback</label></div></div></li>');
          if (resp === 'accept_different_type'){
            $('#type_'+i).append('<div class="col s5">'+r['Select what kind of session you\'d like to run:']+'</div><div class="col s2 center-align"><i class="material-icons">chevron_right</i></div><div class="col s5">'+r[rev+' Type']+'</div>');
            $('#type_'+i).show();
          }
        }*/
      }

    }

    // Refresh materialize components
    Materialize.updateTextFields();
    $('.materialize-textarea').trigger('autoresize');
    $('.scrollspy').scrol

    // hide progress bar
    $('.progress').hide();
  }

  function countWords(s) {
    s = s.replace(/(^\s*)|(\s*$)/gi, ""); //exclude  start and end white-space
    s = s.replace(/[ ]{2,}/gi, " "); //2 or more space to 1
    s = s.replace(/\n /, "\n"); // exclude newline with a start spacing
    return s.split(' ').length;
  }
      // initialize materialize components
    $(document).ready(function() {
      $('select').material_select();
      $('.collapsible').collapsible();
      $('.tooltipped').tooltip();
      $('.scrollspy').scrollSpy();

      $('select[required]').css({
        display: 'inline',
        position: 'absolute',
        float: 'left',
        padding: 0,
        margin: 0,
        border: '1px solid rgba(255,255,255,0)',
        height: 0,
        width: 0,
        top: '2em',
        left: '3em',
        opacity: 0
      });
    });
</script>
